(this["webpackJsonpreact-exercise"]=this["webpackJsonpreact-exercise"]||[]).push([[0],{17:function(t,a,e){t.exports=e.p+"weiya5.ebb7772c.jpeg"},18:function(t,a,e){t.exports=e.p+"bilibili-video2.8097d33f.mp4"},45:function(t,a,e){t.exports=e(65)},50:function(t,a,e){},51:function(t,a,e){t.exports=e.p+"logo.25bf045c.svg"},52:function(t,a,e){},53:function(t,a,e){},55:function(t,a,e){},62:function(t,a){},63:function(t,a){},64:function(t,a){},65:function(t,a,e){"use strict";e.r(a);var n=e(1),i=e.n(n),s=e(16),r=e.n(s),u=(e(50),e(8));e(51),e(52),i.a.createContext(),e(53);var c=e(2),o=e.n(c),m=e(4),d=function(t){if(!t||!t.data)return null;var a=t.width,e=t.height,n=t.data,i=0,s=0,r=Number.MAX_SAFE_INTEGER,u=-1,c=Number.MAX_SAFE_INTEGER,o=-1;for(i=0;i<e;i++)for(s=0;s<a;s++){1===n[i*a+s]&&(s<=c&&(c=s),s>o&&(o=s),i<=r&&(r=i),i>u&&(u=i))}return{top:r,left:c,bottom:u,right:o}},h=e(19),l=(e(55),e(17)),f=e.n(l),v=e(18),p=e.n(v),b=e(56);function g(){var t=Object(n.useState)(""),a=Object(u.a)(t,2),e=(a[0],a[1],Object(n.useRef)(null)),s=Object(n.useRef)(null),r=Object(n.useRef)(null),c=Object(n.useRef)(null),l=Object(n.useRef)(null),v=Object(n.useRef)(null);Object(n.useEffect)((function(){function t(){return(t=Object(m.a)(o.a.mark((function t(){var a,n,i,r,u;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.load({architecture:"MobileNetV1",outputStride:16,multiplier:.75,quantBytes:2}).catch((function(t){console.log("load engine error",t)}));case 2:return a=t.sent,n=(new Date).getTime(),t.next=6,a.segmentPerson(e.current).catch((function(t){console.log("error",t)}));case 6:i=t.sent,console.log(i,"cost ",(new Date).getTime()-n),r=b.toMask(i),.7,!1,0,u=s.current,b.drawMask(u,e.current,r,.7,0,!1);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return function(){t.apply(this,arguments)}(),function(){}}),[e]),Object(n.useEffect)((function(){var t;function a(){return e.apply(this,arguments)}function e(){return(e=Object(m.a)(o.a.mark((function a(){var e,n,i,s,u,m,h,f;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.segmentPerson(r.current).catch((function(t){console.log("error",t)}));case 2:if(e=a.sent){a.next=5;break}return a.abrupt("return");case 5:if(!(n=d(e))){a.next=17;break}if(i={width:e.width,height:e.height,bodyCoordinate:n},g(i),s=v.current){a.next=12;break}return a.abrupt("return");case 12:u=(new XMLSerializer).serializeToString(s),m="data:image/svg+xml;base64,".concat(window.btoa(u)),(h=l.current).style.maskImage="url(".concat(m,")"),h.style.WebkitMaskImage="url(".concat(m,")");case 17:f=b.toMask(e),.7,!1,0,b.drawMask(c.current,r.current,f,.7,0,!1);case 22:case"end":return a.stop()}}),a)})))).apply(this,arguments)}function n(){return(n=Object(m.a)(o.a.mark((function a(){return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.load({architecture:"MobileNetV1",outputStride:16,multiplier:.5,quantBytes:2}).catch((function(t){console.log("load engine error",t)}));case 2:t=a.sent;case 3:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return function(){n.apply(this,arguments)}(),r.current.addEventListener("play",(function(){function t(){return e.apply(this,arguments)}function e(){return(e=Object(m.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&r.current){e.next=2;break}return e.abrupt("return");case 2:if(r.current.paused||r.current.ended){e.next=6;break}return e.next=5,a();case 5:requestAnimationFrame(t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}requestAnimationFrame(t)})),function(){}}),[]);var g=function(t){var a=t.width,e=t.height,n=t.bodyCoordinate,i=Object(h.a)("#mySvg");i.attr("width",a).attr("height",e);var s=[n],r=i.selectAll("path").data(s),u=r.enter();r.exit().remove();var c=[];c[0]="".concat(a," 0"),c[1]="".concat(a," ").concat(e),c[2]="0 ".concat(e);var o=function(t){var a=t.top,e=t.left,n=t.bottom,i=t.right;c[3]="0 ".concat(n),c[4]="".concat(e," ").concat(n),c[5]="".concat(i," ").concat(n),c[6]="".concat(i," ").concat(a),c[7]="".concat(e," ").concat(a),c[8]=c[4],c[9]=c[3];var s=c.join(" L ");return s="M".concat("0 0"," ").concat(s," Z")};r.attr("d",o),u.append("path").attr("d",o)};return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,"\u4eba\u4f53\u5206\u5272"),i.a.createElement("img",{src:f.a,ref:e}),i.a.createElement("canvas",{id:"canvas",ref:s}),i.a.createElement("div",{className:"videoContainer"},i.a.createElement("video",{controls:!0,src:p.a,id:"myVideo",ref:r}," "),i.a.createElement("div",{className:"danmuContainer",ref:l},i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu "),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"),i.a.createElement("div",{className:"danmuContent"},"this is a danmu this is a danmu this is a danmu this is a danmu this is a danmu"))),i.a.createElement("canvas",{id:"videoCanvas",ref:c}),i.a.createElement("svg",{width:"0",height:"0",version:"1.1",xmlns:"http://www.w3.org/2000/svg",id:"mySvg",ref:v}))}var E=function(){var t=Object(n.useState)({}),a=Object(u.a)(t,2),e=(a[0],a[1]);function s(){return new Promise((function(t,a){setTimeout((function(){t({userName:"Tom",loggin:!0})}),1e3)}))}return Object(n.useEffect)((function(){s().then((function(t){e(t)}))}),[]),i.a.createElement(g,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(E,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[45,1,2]]]);
//# sourceMappingURL=main.67160bb1.chunk.js.map